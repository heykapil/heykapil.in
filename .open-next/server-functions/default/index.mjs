globalThis.monorepoPackagePath = "";import process from 'node:process';import { Buffer } from 'node:buffer';import { createRequire as topLevelCreateRequire } from 'module';const require = topLevelCreateRequire(import.meta.url);import bannerUrl from 'url';const __dirname = bannerUrl.fileURLToPath(new URL('.', import.meta.url));globalThis.openNextDebug = false;globalThis.openNextVersion = "3.0.8";
var zt=Object.defineProperty;var $=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var C=(e,t)=>()=>(e&&(t=e(e=0)),t);var K=(e,t)=>{for(var r in t)zt(e,r,{get:t[r],enumerable:!0})};function x(...e){globalThis.openNextDebug&&console.log(...e)}function ve(...e){console.warn(...e)}function A(...e){if(e.some(t=>Kt(t)))x(...e);else if(e.some(t=>t.__openNextInternal)){let t=e.find(r=>r.__openNextInternal);if(t.logLevel===0){x(...e);return}else if(t.logLevel===1){ve(...e);return}else{console.error(...e);return}}else console.error(...e)}var Wt,Kt,R=C(()=>{Wt=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],Kt=e=>Wt.some(t=>t.clientName===e?.clientName&&t.commandName===e?.commandName&&(t.errorName===e?.error?.name||t.errorName===e?.error?.Code))});import D from"fs";import k from"path";function Oe(e){let t=k.join(e,"required-server-files.json"),r=D.readFileSync(t,"utf-8"),{config:s}=JSON.parse(r);return s}function Ie(e){let t=k.join(e,"BUILD_ID");return D.readFileSync(t,"utf-8").trim()}function De(e){let t=k.join(e,"server","pages-manifest.json"),r=D.readFileSync(t,"utf-8");return Object.entries(JSON.parse(r)).filter(([s,a])=>a.endsWith(".html")).map(([s])=>s)}function ke(e){let t=k.join(e,"routes-manifest.json"),r=D.readFileSync(t,"utf-8"),s=JSON.parse(r),a=s.dataRoutes??[],o={static:a.filter(n=>n.routeKeys===void 0),dynamic:a.filter(n=>n.routeKeys!==void 0)};return{rewrites:Array.isArray(s.rewrites)?{beforeFiles:[],afterFiles:s.rewrites,fallback:[]}:{beforeFiles:s.rewrites.beforeFiles??[],afterFiles:s.rewrites.afterFiles??[],fallback:s.rewrites.fallback??[]},redirects:s.redirects??[],routes:{static:s.staticRoutes??[],dynamic:s.dynamicRoutes??[],data:o},locales:s.i18n?.locales??[]}}function Fe(e){let t=k.join(e,"routes-manifest.json"),r=D.readFileSync(t,"utf-8");return JSON.parse(r).headers}function qe(e){let t=k.join(e,"prerender-manifest.json"),r=D.readFileSync(t,"utf-8");return JSON.parse(r)}function Be(e){let t=k.join(e,"server","middleware-manifest.json"),r=D.readFileSync(t,"utf-8");return JSON.parse(r)}var $e=C(()=>{});import Le from"path";var j,Xt,T,L,Ue,M,ze,We,Ke,F=C(()=>{R();$e();j=Le.join(__dirname,".next"),Xt=Le.join(__dirname,".open-next");x({NEXT_DIR:j,OPEN_NEXT_DIR:Xt});T=Oe(j),L=Ie(j),Ue=De(j),M=ke(j),ze=Fe(j),We=qe(j),Ke=Be(j)});function Xe(){process.env.NODE_ENV=process.env.NODE_ENV??"production"}function Qe(){return Math.random().toString(36).slice(2,8)}function be(e,t){return e.reduce((s,a,o)=>{let n=Math.floor(o/t);return s[n]=[...s[n]??[],a],s},new Array)}function re(e){if(typeof e!="string")return e;let t=parseInt(e);return isNaN(t)?void 0:t}var X=C(()=>{});function ae(e){if(e)return typeof e=="string"?e.split(/(?<!Expires=\w+),/i).map(t=>t.trim()):e}var se,Qt,oe=C(()=>{se=e=>{let t={};if(!e)return t;for(let[r,s]of Object.entries(e))s!==void 0&&(t[r]=Qt(s));return t},Qt=e=>typeof e=="string"?e:Array.isArray(e)?e.join(","):String(e)});import{Transform as Vt}from"stream";var q,B,ne,Ee=C(()=>{R();oe();q="set-cookie",B="This cannot be used in OpenNext",ne=class extends Vt{fixHeaders;streamCreator;initialHeaders;statusCode;statusMessage="";headers={};_cookies=[];responseStream;headersSent=!1;_chunks=[];strictContentLength=!1;assignSocket(t){throw new Error(B)}detachSocket(t){throw new Error(B)}writeContinue(t){throw new Error(B)}writeEarlyHints(t,r){throw new Error(B)}writeProcessing(){throw new Error(B)}req;chunkedEncoding=!1;shouldKeepAlive=!0;useChunkedEncodingByDefault=!0;sendDate=!1;connection=null;socket=null;setTimeout(t,r){throw new Error(B)}addTrailers(t){throw new Error(B)}constructor(t,r,s,a){super(),this.fixHeaders=t,this.streamCreator=s,this.initialHeaders=a,a&&a[q]&&(this._cookies=ae(a[q])),this.once("finish",()=>{this.headersSent||this.flushHeaders(),globalThis.__als?.getStore()?.pendingPromiseRunner.add(r(this.headers));let o=this.body.length;this.streamCreator?.onFinish(o)})}get originalResponse(){return this}get finished(){return!!(this.writableFinished&&this.responseStream?.writableFinished)}setHeader(t,r){let s=t.toLowerCase();return s===q&&(Array.isArray(r)?this._cookies=r:this._cookies=[r]),this.headers[s]=r,this}removeHeader(t){let r=t.toLowerCase();return r===q?this._cookies=[]:delete this.headers[r],this}hasHeader(t){let r=t.toLowerCase();return r===q?this._cookies.length>0:this.headers[r]!==void 0}getHeaders(){return this.headers}getFixedHeaders(){return this.fixHeaders(this.headers),this.headers[q]=this._cookies,this.headers}getHeader(t){return this.headers[t.toLowerCase()]}getHeaderNames(){return Object.keys(this.headers)}flushHeaders(){this.headersSent=!0,this.initialHeaders&&(this.headers={...this.headers,...this.initialHeaders}),this.fixHeaders(this.headers),this._cookies.length>0&&(this.headers[q]=this._cookies),this.streamCreator&&(this.responseStream=this.streamCreator?.writeHeaders({statusCode:this.statusCode??200,cookies:this._cookies,headers:se(this.headers)}),this.pipe(this.responseStream))}appendHeader(t,r){let s=t.toLowerCase();if(this.hasHeader(s)){let a=this.getHeader(s),o=Array.isArray(r)?r:[r],n=Array.isArray(a)?[...a,...o]:[a,...o];return this.setHeader(s,n)}else return this.setHeader(s,r)}writeHead(t,r,s){let a=s,o;typeof r=="string"?o=r:a=r;let n=this.headers;if(a)if(Array.isArray(a))for(let i=0;i<a.length;i+=2)n[a[i]]=a[i+1];else for(let i of Object.keys(a))n[i]=a[i];return this.statusCode=t,s&&(this.headers=n),this.flushHeaders(),this}get body(){return Buffer.concat(this._chunks)}_internalWrite(t,r){this._chunks.push(Buffer.from(t,r)),this.push(t,r),this.streamCreator?.onWrite?.()}_transform(t,r,s){this.headersSent||this.flushHeaders(),this._internalWrite(t,r),s()}_flush(t){this.body.length<1&&process.env.OPEN_NEXT_FORCE_NON_EMPTY_RESPONSE==="true"&&(x('Force writing "SOMETHING" to the response body'),this.push("SOMETHING")),t()}get sent(){return this.finished||this.headersSent}getHeaderValues(t){let r=this.getHeader(t);if(r!==void 0)return(Array.isArray(r)?r:[r]).map(s=>s.toString())}send(){let t=this.body;this.end(t)}}});function Ve(e){if(!e)return!1;let t=e?.split(";")[0]??"";return Jt.has(t)}var Jt,Ge=C(()=>{Jt=new Set(["application/octet-stream","application/epub+zip","application/msword","application/pdf","application/rtf","application/vnd.amazon.ebook","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","font/otf","font/woff","font/woff2","image/bmp","image/gif","image/jpeg","image/png","image/tiff","image/vnd.microsoft.icon","image/webp","audio/3gpp","audio/aac","audio/basic","audio/mpeg","audio/ogg","audio/wavaudio/webm","audio/x-aiff","audio/x-midi","audio/x-wav","video/3gpp","video/mp2t","video/mpeg","video/ogg","video/quicktime","video/webm","video/x-msvideo","application/java-archive","application/vnd.apple.installer+xml","application/x-7z-compressed","application/x-apple-diskimage","application/x-bzip","application/x-bzip2","application/x-gzip","application/x-java-archive","application/x-rar-compressed","application/x-tar","application/x-zip","application/zip"])});import Yt from"node:crypto";function de(e,t){if(!e)return!1;let r=/^https?:\/\//;return t?r.test(e)&&!e.includes(t):r.test(e)}function Ye(e){return e===""?{}:e.split("&").reduce((r,s)=>{let[a,o]=s.split("=");return{...r,[a]:o}},{})}function Ze(e,t){if(!t){let a=/\/([^?]*)\??(.*)/,o=e.match(a);return{hostname:"",pathname:o?.[1]??e,protocol:"",queryString:o?.[2]??""}}let r=/^(https?:)\/\/?([^\/\s]+)(\/[^?]*)?(\?.*)?/,s=e.match(r);if(!s)throw new Error(`Invalid external URL: ${e}`);return{protocol:s[1]??"https:",hostname:s[2],pathname:s[3],queryString:s[4]?.slice(1)??""}}function et(e){let t=e.statusCode||200,r=se(e.getFixedHeaders()),s=Ve(Array.isArray(r["content-type"])?r["content-type"][0]:r["content-type"]),a=s?"base64":"utf8",o=e.body.toString(a);return{statusCode:t,headers:r,body:o,isBase64Encoded:s}}function V(e){let t=new URLSearchParams;Object.entries(e).forEach(([s,a])=>{Array.isArray(a)?a.forEach(o=>t.append(s,o)):t.append(s,a)});let r=t.toString();return r?`?${r}`:""}function tt(e){let t=new URLSearchParams(e),r={};for(let s of t.keys()){let a=t.getAll(s);r[s]=a.length>1?a:a[0]}return r}function rt(e){let t=e.middleware["/"];return t?.matchers?t.matchers.map(({regexp:r})=>new RegExp(r)):[]}function G(e){let t=e.replace(/\(\.\)/g,"_\xB51_");return t=t.replace(/\(\.{2}\)/g,"_\xB52_"),t=t.replace(/\(\.{3}\)/g,"_\xB53_"),t}function le(e){let t=e.replace(/_µ1_/g,"(.)");return t=t.replace(/_µ2_/g,"(..)"),t=t.replace(/_µ3_/g,"(...)"),t}function Je(e){let t={},r=["host","connection","via","x-cache","transfer-encoding","content-encoding"];return Object.entries(e).forEach(([s,a])=>{let o=s.toLowerCase();r.includes(o)||o.startsWith("x-amz")||(t[s]=a?.toString()??"")}),t}function st(e,t){return e==="GET"||e==="HEAD"||!t?void 0:new ReadableStream({start(s){s.enqueue(t),s.close()}})}async function at(e,t){let{url:r,headers:s,method:a,body:o}=e,n=await import("node:https").then(i=>i.request);x("proxyRequest",r),await new Promise((i,c)=>{let p=Je(s);x("filteredHeaders",p);let u=n(r,{headers:p,method:a,rejectUnauthorized:!1},d=>{t.writeHead(d.statusCode??200,Je(d.headers)),d.headers["content-encoding"]==="br"?d.pipe($("node:zlib").createBrotliDecompress()).pipe(t):d.headers["content-encoding"]==="gzip"?d.pipe($("node:zlib").createGunzip()).pipe(t):d.pipe(t),d.on("error",f=>{A("proxyRequest error",f),t.end(),c(f)}),d.on("end",()=>{i()})});o&&a!=="GET"&&a!=="HEAD"&&u.write(o),u.end()})}function Zt(e,t){if(e==="/404"||e==="/500"){t[N.CACHE_CONTROL]="private, no-cache, no-store, max-age=0, must-revalidate";return}Ue.includes(e)&&(t[N.CACHE_CONTROL]="public, max-age=0, s-maxage=31536000, must-revalidate")}function er(e){let t=e[N.CACHE_CONTROL];t&&(Array.isArray(t)&&(t=t.join(",")),typeof t=="string"&&(e[N.CACHE_CONTROL]=t.replace(/\bstale-while-revalidate(?!=)/,"stale-while-revalidate=2592000")))}function tr(e){e["X-OpenNext"]="1",globalThis.openNextDebug&&(e["X-OpenNext-Version"]=globalThis.openNextVersion,e["X-OpenNext-RequestId"]=globalThis.__als.getStore()?.requestId)}async function rr(e,t,r,s){if(r[N.NEXT_CACHE]==="STALE"){let a=s?.[Symbol.for("NextInternalRequestMeta")],o=a?._nextDidRewrite?t.startsWith("/_next/data/")?`/_next/data/${L}${a?._nextRewroteUrl}.json`:a?._nextRewroteUrl:t;try{let n=u=>Yt.createHash("md5").update(u).digest("hex"),i=globalThis.__als.getStore()?.requestId??"",c=globalThis.lastModified[i]>0?globalThis.lastModified[i]:"",p=r.etag??r.ETag??"";await globalThis.queue.send({MessageBody:{host:e,url:o},MessageDeduplicationId:n(`${t}-${c}-${p}`),MessageGroupId:sr(t)})}catch(n){A(`Failed to revalidate stale page ${t}`,n)}}}function sr(e){let t=ar(e);var r=t+=1831565813;r=Math.imul(r^r>>>15,r|1),r^=r+Math.imul(r^r>>>7,r|61);let s=((r^r>>>14)>>>0)/4294967296,a=parseInt(process.env.MAX_REVALIDATE_CONCURRENCY??"10");return`revalidate-${Math.floor(s*a)}`}function ar(e){let t=1779033703,r=3144134277,s=1013904242,a=2773480762;for(let o=0,n;o<e.length;o++)n=e.charCodeAt(o),t=r^Math.imul(t^n,597399067),r=s^Math.imul(r^n,2869860233),s=a^Math.imul(s^n,951274213),a=t^Math.imul(a^n,2716044179);return t=Math.imul(s^t>>>18,597399067),r=Math.imul(a^r>>>22,2869860233),s=Math.imul(t^s>>>17,951274213),a=Math.imul(r^a>>>19,2716044179),t^=r^s^a,r^=t,s^=t,a^=t,t>>>0}function or(e){if(e[N.NEXT_CACHE]==="REVALIDATED"){e[N.CACHE_CONTROL]="private, no-cache, no-store, max-age=0, must-revalidate";return}let t=globalThis.__als.getStore()?.requestId??"",r=globalThis.lastModified[t]??0;if(e[N.NEXT_CACHE]==="HIT"&&r>0){let s=Math.round((Date.now()-r)/1e3),a=/s-maxage=(\d+)/,o=e[N.CACHE_CONTROL];if(x("cache-control",o,globalThis.lastModified,Date.now()),typeof o!="string")return;let n=o.match(a),i=n?parseInt(n[1]):void 0;if(i&&i!==31536e3){let c=Math.max(i-s,1);e[N.CACHE_CONTROL]=`s-maxage=${c}, stale-while-revalidate=2592000`}}e[N.NEXT_CACHE]==="STALE"&&(e[N.CACHE_CONTROL]="s-maxage=2, stale-while-revalidate=2592000")}function _e(e,t,r){return new ne(s=>{Zt(e.rawPath,s),er(s),tr(s),or(s)},async s=>{await rr(e.headers.host,e.rawPath,s)},r,t)}var N,J=C(()=>{F();Ee();oe();Ge();R();(function(e){e.CACHE_CONTROL="cache-control",e.NEXT_CACHE="x-nextjs-cache"})(N||(N={}))});function wt(e){let t={};for(let[r,s]of Object.entries(e))s!==void 0&&(t[r]=s);return t}var vt=C(()=>{});var bt={};K(bt,{default:()=>Nr});function Ar(e){let{body:t,isBase64Encoded:r}=e;return Buffer.isBuffer(t)?t:typeof t=="string"?Buffer.from(t,r?"base64":"utf8"):typeof t=="object"?Buffer.from(JSON.stringify(t)):Buffer.from("","utf8")}function Sr(e){let{headers:t,cookies:r}=e,s={};Array.isArray(r)&&(s.cookie=r.join("; "));for(let[a,o]of Object.entries(t||{}))s[a.toLowerCase()]=o;return s}async function Rr(e){let{rawPath:t,rawQueryString:r,requestContext:s}=e;return{type:"core",method:s.http.method,rawPath:t,url:t+(r?`?${r}`:""),body:Ar(e),headers:Sr(e),remoteAddress:s.http.sourceIp,query:wt(tt(r)),cookies:e.cookies?.reduce((a,o)=>{let[n,i]=o.split("=");return{...a,[n]:i}},{})??{}}}function Tr(e){let t={};Object.entries(e.headers).filter(([s])=>!Cr.some(a=>typeof a=="string"?a===s:a.test(s))).forEach(([s,a])=>{if(a==null){t[s]="";return}t[s]=Array.isArray(a)?a.join(", "):`${a}`});let r={statusCode:e.statusCode,headers:t,cookies:ae(e.headers["set-cookie"]),body:e.body,isBase64Encoded:e.isBase64Encoded};return x(r),r}var Cr,Nr,Et=C(()=>{oe();R();J();vt();Cr=["connection","expect","keep-alive","proxy-authenticate","proxy-authorization","proxy-connection","trailer","upgrade","x-accel-buffering","x-accel-charset","x-accel-limit-rate","x-accel-redirect",/x-amz-cf-(.*)/,/x-amzn-(.*)/,/x-edge-(.*)/,"x-cache","x-forwarded-proto","x-real-ip","set-cookie","age","via"];Nr={convertFrom:Rr,convertTo:Tr,name:"aws-apigw-v2"}});var _t={};K(_t,{default:()=>jr});import{Writable as Hr}from"stream";function Pr(e){return new Promise(t=>{setTimeout(()=>{t({serverId,type:"warmer"})},e.delay)})}var Mr,jr,Ct=C(()=>{Mr=async(e,t)=>async r=>{if("type"in r)return Pr(r);let s=await t.convertFrom(r),o=await e(s,{writeHeaders:()=>new Hr({write:(n,i,c)=>{c()}}),onFinish:()=>{}});return t.convertTo(o,r)},jr={wrapper:Mr,name:"aws-lambda",supportStreaming:!1}});async function Z(e,t){let r=await crypto.subtle.importKey("raw",typeof e=="string"?Ne.encode(e):e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",r,Ne.encode(t))}async function At(e){return crypto.subtle.digest("SHA-256",typeof e=="string"?Ne.encode(e):e)}function Te(e){let t=new Uint8Array(e),r="";for(let s=0;s<t.length;s++){let a=t[s];r+=St[a>>>4&15],r+=St[a&15]}return r}function Rt(e){return e.replace(/[!'()*]/g,t=>"%"+t.charCodeAt(0).toString(16).toUpperCase())}function Dr(e,t){let{hostname:r,pathname:s}=e;if(r.endsWith(".on.aws")){let i=r.match(/^[^.]+\.lambda-url\.([^.]+)\.on\.aws$/);return i!=null?["lambda",i[1]||""]:["",""]}if(r.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(r.endsWith(".backblazeb2.com")){let i=r.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return i!=null?["s3",i[1]||""]:["",""]}let a=r.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/),o=a&&a[1]||"",n=a&&a[2];if(n==="us-gov")n="us-gov-west-1";else if(n==="s3"||n==="s3-accelerate")n="us-east-1",o="s3";else if(o==="iot")r.startsWith("iot.")?o="execute-api":r.startsWith("data.jobs.iot.")?o="iot-jobs-data":o=s==="/mqtt"?"iotdevicegateway":"iotdata";else if(o==="autoscaling"){let i=(t.get("X-Amz-Target")||"").split(".")[0];i==="AnyScaleFrontendService"?o="application-autoscaling":i==="AnyScaleScalingPlannerFrontendService"&&(o="autoscaling-plans")}else n==null&&o.startsWith("s3-")?(n=o.slice(3).replace(/^fips-|^external-1/,""),o="s3"):o.endsWith("-fips")?o=o.slice(0,-5):n&&/-\d$/.test(o)&&!/-\d$/.test(n)&&([o,n]=[n,o]);return[Or[o]||o,n||""]}var Ne,Or,Ir,O,He,St,pe=C(()=>{Ne=new TextEncoder,Or={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},Ir=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]),O=class{constructor({accessKeyId:t,secretAccessKey:r,sessionToken:s,service:a,region:o,cache:n,retries:i,initRetryMs:c}){if(t==null)throw new TypeError("accessKeyId is a required option");if(r==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=t,this.secretAccessKey=r,this.sessionToken=s,this.service=a,this.region=o,this.cache=n||new Map,this.retries=i??10,this.initRetryMs=c||50}async sign(t,r){if(t instanceof Request){let{method:o,url:n,headers:i,body:c}=t;r=Object.assign({method:o,url:n,headers:i},r),r.body==null&&i.has("Content-Type")&&(r.body=c!=null&&i.has("X-Amz-Content-Sha256")?c:await t.clone().arrayBuffer()),t=n}let s=new He(Object.assign({url:t.toString()},r,this,r&&r.aws)),a=Object.assign({},r,await s.sign());delete a.aws;try{return new Request(a.url.toString(),a)}catch(o){if(o instanceof TypeError)return new Request(a.url.toString(),Object.assign({duplex:"half"},a));throw o}}async fetch(t,r){for(let s=0;s<=this.retries;s++){let a=fetch(await this.sign(t,r));if(s===this.retries)return a;let o=await a;if(o.status<500&&o.status!==429)return o;await new Promise(n=>setTimeout(n,Math.random()*this.initRetryMs*Math.pow(2,s)))}throw new Error("An unknown error occurred, ensure retries is not negative")}},He=class{constructor({method:t,url:r,headers:s,body:a,accessKeyId:o,secretAccessKey:n,sessionToken:i,service:c,region:p,cache:u,datetime:d,signQuery:f,appendSessionToken:g,allHeaders:h,singleEncode:y}){if(r==null)throw new TypeError("url is a required option");if(o==null)throw new TypeError("accessKeyId is a required option");if(n==null)throw new TypeError("secretAccessKey is a required option");this.method=t||(a?"POST":"GET"),this.url=new URL(r),this.headers=new Headers(s||{}),this.body=a,this.accessKeyId=o,this.secretAccessKey=n,this.sessionToken=i;let m,w;(!c||!p)&&([m,w]=Dr(this.url,this.headers)),this.service=c||m||"",this.region=p||w||"us-east-1",this.cache=u||new Map,this.datetime=d||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=f,this.appendSessionToken=g||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service==="s3"&&!this.signQuery&&!this.headers.has("X-Amz-Content-Sha256")&&this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");let b=this.signQuery?this.url.searchParams:this.headers;if(b.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&b.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(l=>h||!Ir.has(l)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(l=>l+":"+(l==="host"?this.url.host:(this.headers.get(l)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service==="s3"&&!b.has("X-Amz-Expires")&&b.set("X-Amz-Expires","86400"),b.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),b.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),b.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");y||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=Rt(this.encodedPath);let _=new Set;this.encodedSearch=[...this.url.searchParams].filter(([l])=>{if(!l)return!1;if(this.service==="s3"){if(_.has(l))return!1;_.add(l)}return!0}).map(l=>l.map(v=>Rt(encodeURIComponent(v)))).sort(([l,v],[E,S])=>l<E?-1:l>E?1:v<S?-1:v>S?1:0).map(l=>l.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){let t=this.datetime.slice(0,8),r=[this.secretAccessKey,t,this.region,this.service].join(),s=this.cache.get(r);if(!s){let a=await Z("AWS4"+this.secretAccessKey,t),o=await Z(a,this.region),n=await Z(o,this.service);s=await Z(n,"aws4_request"),this.cache.set(r,s)}return Te(await Z(s,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,Te(await At(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let t=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(t==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");t=Te(await At(this.body||""))}return t}};St=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]});var fe,H,he=C(()=>{fe=class extends Error{__openNextInternal=!0;canIgnore=!0;logLevel=0;constructor(t){super(t),this.name="IgnorableError"}},H=class extends Error{__openNextInternal=!0;canIgnore=!0;logLevel=1;constructor(t){super(t),this.name="RecoverableError"}}});function W(e){return async(t,r)=>{let s=await e.sign(t,r),a={};return s.headers.forEach((i,c)=>{a[c]=i}),(await globalThis.internalFetch(s.url,{method:s.method,headers:a,body:r.body})).clone()}}var me=C(()=>{});var Tt,Nt=C(()=>{Tt=()=>{let e=process.env.DYNAMO_BATCH_WRITE_COMMAND_CONCURRENCY,t=e?parseInt(e):void 0;return t&&!isNaN(t)?t:4}});var Pt={};K(Pt,{default:()=>Lr});import Fr from"path";function te(e){return Fr.posix.join(Ht??"",e)}function Br(e,t,r){return{path:{S:te(e)},tag:{S:te(t)},revalidatedAt:{N:`${r??Date.now()}`}}}var ee,ge,Ht,qr,ye,$r,Lr,Mt=C(()=>{pe();he();me();R();X();Nt();({CACHE_BUCKET_REGION:ee,CACHE_DYNAMO_TABLE:ge,NEXT_BUILD_ID:Ht}=process.env),qr=new O({accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,sessionToken:process.env.AWS_SESSION_TOKEN,region:ee,retries:re(process.env.AWS_SDK_S3_MAX_ATTEMPTS)}),ye=W(qr);$r={async getByPath(e){try{if(globalThis.disableDynamoDBCache)return[];let t=await ye(`https://dynamodb.${ee}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"DynamoDB_20120810.Query"},body:JSON.stringify({TableName:ge,IndexName:"revalidate",KeyConditionExpression:"#key = :key",ExpressionAttributeNames:{"#key":"path"},ExpressionAttributeValues:{":key":{S:te(e)}}})});if(t.status!==200)throw new H(`Failed to get tags by path: ${t.status}`);let{Items:r}=await t.json(),s=r?.map(a=>a.tag.S??"")??[];return x("tags for path",e,s),s}catch(t){return A("Failed to get tags by path",t),[]}},async getByTag(e){try{if(globalThis.disableDynamoDBCache)return[];let t=await ye(`https://dynamodb.${ee}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"DynamoDB_20120810.Query"},body:JSON.stringify({TableName:ge,KeyConditionExpression:"#tag = :tag",ExpressionAttributeNames:{"#tag":"tag"},ExpressionAttributeValues:{":tag":{S:te(e)}}})});if(t.status!==200)throw new H(`Failed to get by tag: ${t.status}`);let{Items:r}=await t.json();return r?.map(({path:{S:s}})=>s?.replace(`${Ht}/`,"")??"")??[]}catch(t){return A("Failed to get by tag",t),[]}},async getLastModified(e,t){try{if(globalThis.disableDynamoDBCache)return t??Date.now();let r=await ye(`https://dynamodb.${ee}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"DynamoDB_20120810.Query"},body:JSON.stringify({TableName:ge,IndexName:"revalidate",KeyConditionExpression:"#key = :key AND #revalidatedAt > :lastModified",ExpressionAttributeNames:{"#key":"path","#revalidatedAt":"revalidatedAt"},ExpressionAttributeValues:{":key":{S:te(e)},":lastModified":{N:String(t??0)}}})});if(r.status!==200)throw new H(`Failed to get last modified: ${r.status}`);let s=(await r.json()).Items??[];return x("revalidatedTags",s),s.length>0?-1:t??Date.now()}catch(r){return A("Failed to get revalidated tags",r),t??Date.now()}},async writeTags(e){try{if(globalThis.disableDynamoDBCache)return;let t=be(e,25).map(s=>({RequestItems:{[ge??""]:s.map(a=>({PutRequest:{Item:{...Br(a.path,a.tag,a.revalidatedAt)}}}))}})),r=be(t,Tt());for(let s of r)await Promise.all(s.map(async a=>{let o=await ye(`https://dynamodb.${ee}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"DynamoDB_20120810.BatchWriteItem"},body:JSON.stringify(a)});if(o.status!==200)throw new H(`Failed to batch write dynamo item: ${o.status}`);return o}))}catch(t){A("Failed to batch write dynamo item",t)}},name:"dynamoDb"},Lr=$r});var Ot={};K(Ot,{default:()=>Xr});var jt,Ur,zr,Wr,Kr,Xr,It=C(()=>{pe();he();me();R();({REVALIDATION_QUEUE_REGION:jt,REVALIDATION_QUEUE_URL:Ur}=process.env),zr=new O({accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,sessionToken:process.env.AWS_SESSION_TOKEN,region:jt}),Wr=W(zr),Kr={send:async({MessageBody:e,MessageDeduplicationId:t,MessageGroupId:r})=>{try{let s=await Wr(`https://sqs.${jt??"us-east-1"}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"AmazonSQS.SendMessage"},body:JSON.stringify({QueueUrl:Ur,MessageBody:JSON.stringify(e),MessageDeduplicationId:t,MessageGroupId:r})});if(s.status!==200)throw new H(`Failed to send message: ${s.status}`)}catch(s){A(s)}},name:"sqs"},Xr=Kr});var Dt={};K(Dt,{default:()=>Zr});import Qr from"path";function je(e,t){return Qr.posix.join(Vr??"",t==="fetch"?"__fetch":"",Gr??"",t==="fetch"?e:`${e}.${t}`)}var xe,Vr,Gr,Pe,Jr,Me,Yr,Zr,kt=C(()=>{pe();he();me();X();({CACHE_BUCKET_REGION:xe,CACHE_BUCKET_KEY_PREFIX:Vr,NEXT_BUILD_ID:Gr,CACHE_BUCKET_NAME:Pe}=process.env),Jr=new O({accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,sessionToken:process.env.AWS_SESSION_TOKEN,region:xe,retries:re(process.env.AWS_SDK_S3_MAX_ATTEMPTS)}),Me=W(Jr);Yr={async get(e,t){let r=await Me(`https://${Pe}.s3.${xe}.amazonaws.com/${je(e,t?"fetch":"cache")}`,{method:"GET"});if(r.status===404)throw new fe("Not found");if(r.status!==200)throw new H(`Failed to get cache: ${r.status}`);return{value:await r.json(),lastModified:new Date(r.headers.get("last-modified")??"").getTime()}},async set(e,t,r){let s=await Me(`https://${Pe}.s3.${xe}.amazonaws.com/${je(e,r?"fetch":"cache")}`,{method:"PUT",body:JSON.stringify(t)});if(s.status!==200)throw new H(`Failed to set cache: ${s.status}`)},async delete(e){let t=await Me(`https://${Pe}.s3.${xe}.amazonaws.com/${je(e,"cache")}`,{method:"DELETE"});if(t.status!==204)throw new H(`Failed to delete cache: ${t.status}`)},name:"s3"},Zr=Yr});F();R();X();import{AsyncLocalStorage as Er}from"node:async_hooks";Ee();import Gt from"node:http";var Q=class extends Gt.IncomingMessage{constructor({method:t,url:r,headers:s,body:a,remoteAddress:o}){super({encrypted:!0,readable:!1,remoteAddress:o,address:()=>({port:443}),end:Function.prototype,destroy:Function.prototype}),typeof s["content-length"]>"u"&&(s["content-length"]=Buffer.byteLength(a).toString()),Object.assign(this,{ip:o,complete:!0,httpVersion:"1.1",httpVersionMajor:"1",httpVersionMinor:"1",method:t,headers:s,body:a,url:r}),this._read=()=>{this.push(a),this.push(null)}}};R();var ie=class{resolve;reject;promise;constructor(){let t,r;this.promise=new Promise((s,a)=>{t=s,r=a}),this.resolve=t,this.reject=r}},ce=class{promises=[];withResolvers(){let t=new ie;return this.promises.push(t),t}add(t){let r=new ie;this.promises.push(r),t.then(r.resolve,r.reject)}async await(){x(`Awaiting ${this.promises.length} detached promises`),(await Promise.allSettled(this.promises.map(s=>s.promise))).filter(s=>s.status==="rejected").forEach(s=>{A(s.reason)})}};R();J();F();R();F();function nr(e){for(var t=[],r=0;r<e.length;){var s=e[r];if(s==="*"||s==="+"||s==="?"){t.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(s==="\\"){t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(s==="{"){t.push({type:"OPEN",index:r,value:e[r++]});continue}if(s==="}"){t.push({type:"CLOSE",index:r,value:e[r++]});continue}if(s===":"){for(var a="",o=r+1;o<e.length;){var n=e.charCodeAt(o);if(n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||n===95){a+=e[o++];continue}break}if(!a)throw new TypeError("Missing parameter name at ".concat(r));t.push({type:"NAME",index:r,value:a}),r=o;continue}if(s==="("){var i=1,c="",o=r+1;if(e[o]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(o));for(;o<e.length;){if(e[o]==="\\"){c+=e[o++]+e[o++];continue}if(e[o]===")"){if(i--,i===0){o++;break}}else if(e[o]==="("&&(i++,e[o+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(o));c+=e[o++]}if(i)throw new TypeError("Unbalanced pattern at ".concat(r));if(!c)throw new TypeError("Missing pattern at ".concat(r));t.push({type:"PATTERN",index:r,value:c}),r=o;continue}t.push({type:"CHAR",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}function ot(e,t){t===void 0&&(t={});for(var r=nr(e),s=t.prefixes,a=s===void 0?"./":s,o="[^".concat(U(t.delimiter||"/#?"),"]+?"),n=[],i=0,c=0,p="",u=function(E){if(c<r.length&&r[c].type===E)return r[c++].value},d=function(E){var S=u(E);if(S!==void 0)return S;var P=r[c],I=P.type,we=P.index;throw new TypeError("Unexpected ".concat(I," at ").concat(we,", expected ").concat(E))},f=function(){for(var E="",S;S=u("CHAR")||u("ESCAPED_CHAR");)E+=S;return E};c<r.length;){var g=u("CHAR"),h=u("NAME"),y=u("PATTERN");if(h||y){var m=g||"";a.indexOf(m)===-1&&(p+=m,m=""),p&&(n.push(p),p=""),n.push({name:h||i++,prefix:m,suffix:"",pattern:y||o,modifier:u("MODIFIER")||""});continue}var w=g||u("ESCAPED_CHAR");if(w){p+=w;continue}p&&(n.push(p),p="");var b=u("OPEN");if(b){var m=f(),_=u("NAME")||"",l=u("PATTERN")||"",v=f();d("CLOSE"),n.push({name:_||(l?i++:""),pattern:_&&!l?o:l,prefix:m,suffix:v,modifier:u("MODIFIER")||""});continue}d("END")}return n}function z(e,t){return ir(ot(e,t),t)}function ir(e,t){t===void 0&&(t={});var r=Ae(t),s=t.encode,a=s===void 0?function(c){return c}:s,o=t.validate,n=o===void 0?!0:o,i=e.map(function(c){if(typeof c=="object")return new RegExp("^(?:".concat(c.pattern,")$"),r)});return function(c){for(var p="",u=0;u<e.length;u++){var d=e[u];if(typeof d=="string"){p+=d;continue}var f=c?c[d.name]:void 0,g=d.modifier==="?"||d.modifier==="*",h=d.modifier==="*"||d.modifier==="+";if(Array.isArray(f)){if(!h)throw new TypeError('Expected "'.concat(d.name,'" to not repeat, but got an array'));if(f.length===0){if(g)continue;throw new TypeError('Expected "'.concat(d.name,'" to not be empty'))}for(var y=0;y<f.length;y++){var m=a(f[y],d);if(n&&!i[u].test(m))throw new TypeError('Expected all "'.concat(d.name,'" to match "').concat(d.pattern,'", but got "').concat(m,'"'));p+=d.prefix+m+d.suffix}continue}if(typeof f=="string"||typeof f=="number"){var m=a(String(f),d);if(n&&!i[u].test(m))throw new TypeError('Expected "'.concat(d.name,'" to match "').concat(d.pattern,'", but got "').concat(m,'"'));p+=d.prefix+m+d.suffix;continue}if(!g){var w=h?"an array":"a string";throw new TypeError('Expected "'.concat(d.name,'" to be ').concat(w))}}return p}}function Ce(e,t){var r=[],s=nt(e,r,t);return cr(s,r,t)}function cr(e,t,r){r===void 0&&(r={});var s=r.decode,a=s===void 0?function(o){return o}:s;return function(o){var n=e.exec(o);if(!n)return!1;for(var i=n[0],c=n.index,p=Object.create(null),u=function(f){if(n[f]===void 0)return"continue";var g=t[f-1];g.modifier==="*"||g.modifier==="+"?p[g.name]=n[f].split(g.prefix+g.suffix).map(function(h){return a(h,g)}):p[g.name]=a(n[f],g)},d=1;d<n.length;d++)u(d);return{path:i,index:c,params:p}}}function U(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Ae(e){return e&&e.sensitive?"":"i"}function dr(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,s=0,a=r.exec(e.source);a;)t.push({name:a[1]||s++,prefix:"",suffix:"",modifier:"",pattern:""}),a=r.exec(e.source);return e}function lr(e,t,r){var s=e.map(function(a){return nt(a,t,r).source});return new RegExp("(?:".concat(s.join("|"),")"),Ae(r))}function ur(e,t,r){return pr(ot(e,r),t,r)}function pr(e,t,r){r===void 0&&(r={});for(var s=r.strict,a=s===void 0?!1:s,o=r.start,n=o===void 0?!0:o,i=r.end,c=i===void 0?!0:i,p=r.encode,u=p===void 0?function(we){return we}:p,d=r.delimiter,f=d===void 0?"/#?":d,g=r.endsWith,h=g===void 0?"":g,y="[".concat(U(h),"]|$"),m="[".concat(U(f),"]"),w=n?"^":"",b=0,_=e;b<_.length;b++){var l=_[b];if(typeof l=="string")w+=U(u(l));else{var v=U(u(l.prefix)),E=U(u(l.suffix));if(l.pattern)if(t&&t.push(l),v||E)if(l.modifier==="+"||l.modifier==="*"){var S=l.modifier==="*"?"?":"";w+="(?:".concat(v,"((?:").concat(l.pattern,")(?:").concat(E).concat(v,"(?:").concat(l.pattern,"))*)").concat(E,")").concat(S)}else w+="(?:".concat(v,"(").concat(l.pattern,")").concat(E,")").concat(l.modifier);else l.modifier==="+"||l.modifier==="*"?w+="((?:".concat(l.pattern,")").concat(l.modifier,")"):w+="(".concat(l.pattern,")").concat(l.modifier);else w+="(?:".concat(v).concat(E,")").concat(l.modifier)}}if(c)a||(w+="".concat(m,"?")),w+=r.endsWith?"(?=".concat(y,")"):"$";else{var P=e[e.length-1],I=typeof P=="string"?m.indexOf(P[P.length-1])>-1:P===void 0;a||(w+="(?:".concat(m,"(?=").concat(y,"))?")),I||(w+="(?=".concat(m,"|").concat(y,")"))}return new RegExp(w,Ae(r))}function nt(e,t,r){return e instanceof RegExp?dr(e,t):Array.isArray(e)?lr(e,t,r):ur(e,t,r)}R();J();var ct=(e,t,r)=>s=>{switch(s.type){case"header":return!!e?.[s.key.toLowerCase()]&&new RegExp(s.value??"").test(e[s.key.toLowerCase()]??"");case"cookie":return!!t?.[s.key]&&new RegExp(s.value??"").test(t[s.key]??"");case"query":return r[s.key]&&Array.isArray(s.value)?s.value.reduce((a,o)=>a||new RegExp(o).test(r[s.key]),!1):new RegExp(s.value??"").test(r[s.key]??"");case"host":return e?.host!==""&&new RegExp(s.value??"").test(e.host);default:return!1}};function ue(e,t,r=!1){return t?t.reduce((s,a)=>s===!1?!1:r?!e(a):e(a),!0):!0}var fr=e=>t=>{x("value",t);let r=e(t);return r?r.params:{}},hr=(e,t,r)=>s=>{if(!s.value)return{};let a=new RegExp(`^${s.value}$`),o=n=>n.match(a)?.groups??{};switch(s.type){case"header":return o(e[s.key.toLowerCase()]??"");case"cookie":return o(t[s.key]??"");case"query":return Array.isArray(r[s.key])?o(r[s.key].join(",")):o(r[s.key]??"");case"host":return o(e.host??"")}};function it(e,t,r){if(e){let{params:s}=e;return Object.keys(s).length>0?t(s):r}else return r}function dt(e,t){let r={};if(!t)return r;let{rawPath:s,headers:a,query:o,cookies:n}=e,i=ct(a,n,o),c={};for(let{headers:p,has:u,missing:d,regex:f,source:g}of t)if(new RegExp(f).test(s)&&ue(i,u)&&ue(i,d,!0)){let y=Ce(g)(s);p.forEach(m=>{try{let w=it(y,z(m.key),m.key),b=it(y,z(m.value),m.value);c[w]=b}catch{x("Error matching header ",m.key," with value ",m.value),c[m.key]=m.value}})}return c}function Y(e,t){let{rawPath:r,headers:s,query:a,cookies:o}=e,n=ct(s,o,a),i=hr(s,o,a),c=t.find(f=>new RegExp(f.regex).test(r)&&ue(n,f.has)&&ue(n,f.missing,!0)),p=a,u=r,d=de(c?.destination);if(x("isExternalRewrite",d),c){let{pathname:f,protocol:g,hostname:h,queryString:y}=Ze(c.destination,d);x("urlParts",{pathname:f,protocol:g,hostname:h,queryString:y});let m=z(G(f??"")??""),w=z(G(h??"")??""),b=z(G(y??"")??""),_={...fr(Ce(G(c?.source)??""))(r),...c.has?.reduce((P,I)=>({...P,...i(I)}),{}),...c.missing?.reduce((P,I)=>({...P,...i(I)}),{})},l=Object.keys(_).length>0,v=y,E=h,S=f;l&&(S=le(m(_)),E=le(w(_)),v=le(b(_))),u=d?`${g}//${E}${S}`:`/${S}`,p={...a,...Ye(v)},x("rewrittenUrl",{rewrittenUrl:u,finalQuery:p,isUsingParams:l})}return{internalEvent:{...e,rawPath:u,url:`${u}${V(p)}`},__rewrite:c,isExternalRewrite:d}}function mr(e){if(new URL(e.url,"http://localhost").host!=="localhost"||T.skipTrailingSlashRedirect||e.rawPath.startsWith("/api/"))return!1;if(T.trailingSlash&&!e.headers["x-nextjs-data"]&&!e.rawPath.endsWith("/")&&!e.rawPath.match(/[\w-]+\.[\w]+$/g)){let r=e.url.split("?");return{type:e.type,statusCode:308,headers:{Location:`${r[0]}/${r[1]?`?${r[1]}`:""}`},body:"",isBase64Encoded:!1}}else if(!T.trailingSlash&&e.rawPath.endsWith("/")&&e.rawPath!=="/"){let r=e.url.split("?");return{type:e.type,statusCode:308,headers:{Location:`${r[0].replace(/\/$/,"")}${r[1]?`?${r[1]}`:""}`},body:"",isBase64Encoded:!1}}else return!1}function lt(e,t){let r=mr(e);if(r)return r;let{internalEvent:s,__rewrite:a}=Y(e,t.filter(o=>!o.internal));if(a&&!a.internal)return{type:e.type,statusCode:a.statusCode??308,headers:{Location:s.url},body:"",isBase64Encoded:!1}}function ut(e,t){let{rawPath:r,query:s}=e,a=`/_next/data/${t}`;if(r.startsWith("/_next/data")&&!r.startsWith(a))return{type:e.type,statusCode:404,body:"{}",headers:{"Content-Type":"application/json"},isBase64Encoded:!1};if(r.startsWith(a)&&r.endsWith(".json")){let o=r.replace(a,"").replace(/\.json$/,"");return o=o==="/index"?"/":o,s.__nextDataReq="1",{...e,rawPath:o,query:s,url:`${o}${V(s)}`}}return e}function pt(e,t){let{rawPath:r}=e,{dynamicRoutes:s,routes:a}=t,o=Object.entries(s).filter(([,{fallback:u}])=>u===!1).some(([,{routeRegex:u}])=>new RegExp(u).test(r)),n=T.i18n?.locales,c=n!==void 0&&n.includes(r.split("/")[1])||n===void 0?r:`/${T.i18n?.defaultLocale}${r}`,p=Object.keys(a).includes(c);return o&&!p?{event:{...e,rawPath:"/404",url:"/404",headers:{...e.headers,"x-invoke-status":"404"}},isISR:!1}:{event:e,isISR:o||p}}F();J();var gr=Ke,yr=rt(gr);function xr(e){let t=e.split("/"),r=T.i18n?.locales;return(r||[]).some(s=>t[1]&&t[1].toLowerCase()===s.toLowerCase()?(t.splice(1,1),e=t.join("/")||"/",!0):!1),r&&!e.endsWith("/")?`${e}/`:e}async function ft(e){let{rawPath:t,query:r}=e,s=xr(t);if(!yr.some(l=>l.test(s))||e.headers["x-isr"])return e;let o=e.headers.host?`https://${e.headers.host}`:"http://localhost:3000",n=new URL(s,o);n.search=V(r);let i=n.toString(),p=await(await import("./middleware.mjs")).default({geo:{city:e.headers["x-open-next-city"],country:e.headers["x-open-next-country"],region:e.headers["x-open-next-region"],latitude:e.headers["x-open-next-latitude"],longitude:e.headers["x-open-next-longitude"]},headers:e.headers,method:e.method||"GET",nextConfig:{basePath:T.basePath,i18n:T.i18n,trailingSlash:T.trailingSlash},url:i,body:st(e.method,e.body)}),u=p.status,d=p.headers,f={},g={};d.delete("x-middleware-override-headers");let h="x-middleware-request-";if(d.forEach((l,v)=>{if(v.startsWith(h)){let E=v.substring(h.length);f[E]=l}else v.toLowerCase()==="set-cookie"?g[v]=g[v]?[...g[v],l]:[l]:g[v]=l}),u>=300&&u<400)return g.location=d.get("location")?.replace("http://localhost:3000",`https://${e.headers.host}`)??g.location,{body:"",type:e.type,statusCode:u,headers:g,isBase64Encoded:!1};let y=d.get("x-middleware-rewrite"),m=!1,w=!1,b=e.query,_=e.url;if(y)if(de(y,e.headers.host))_=y,m=!0,w=!0;else{let l=new URL(y);_=l.pathname,b.__nextDataReq?b={__nextDataReq:b.__nextDataReq}:b={},l.searchParams.forEach((v,E)=>{b[E]=v}),m=!0}if(p.body){let l=await p.arrayBuffer(),v=Buffer.from(l);return{type:e.type,statusCode:u,headers:g,body:v.toString(),isBase64Encoded:!1}}return{responseHeaders:g,url:_,rawPath:m?_??e.rawPath:e.rawPath,type:e.type,headers:{...e.headers,...f},body:e.body,method:e.method,query:b,cookies:e.cookies,remoteAddress:e.remoteAddress,externalRewrite:w}}var gt=M.locales.length?`^/(?:${M.locales.map(e=>`${e}/?`).join("|")})?`:"^/",ht=M.routes.static.map(e=>new RegExp(e.regex.replace("^/",gt))),mt=M.routes.dynamic.map(e=>new RegExp(e.regex.replace("^/",gt)));async function Se(e){let t=dt(e,ze)??{},r=ut(e,L);if("statusCode"in r)return r;let s=lt(r,M.redirects);if(s)return x("redirect",s),s;let a=await ft(r),o={};if("statusCode"in a)return a;o=a.responseHeaders||{},r=a;let n=a.externalRewrite??!1;if(!n){let h=Y(r,M.rewrites.beforeFiles);r=h.internalEvent,n=h.isExternalRewrite}let i=!n&&ht.some(h=>h.test(r.rawPath));if(!i&&!n){let h=Y(r,M.rewrites.afterFiles);r=h.internalEvent,n=h.isExternalRewrite}let{event:c,isISR:p}=pt(r,We);r=c;let u=!n&&mt.some(h=>h.test(r.rawPath));if(!u&&!i&&!n){let h=Y(r,M.rewrites.fallback);r=h.internalEvent,n=h.isExternalRewrite}let d=r.rawPath==="/api"||r.rawPath.startsWith("/api/"),f=r.rawPath.startsWith("/_next/image");return!(i||u||n)&&!d&&!f&&!ht.some(h=>h.test(r.rawPath))&&!mt.some(h=>h.test(r.rawPath))&&(r={...r,rawPath:"/404",url:"/404",headers:{...r.headers,"x-middleware-response-cache-control":"private, no-cache, no-store, max-age=0, must-revalidate"}}),Object.entries({...o,...t}).forEach(([h,y])=>{y&&(r.headers[`x-middleware-response-${h}`]=Array.isArray(y)?y.join(","):y)}),{internalEvent:r,isExternalRewrite:n,origin:!1,isISR:p}}F();R();import vr from"next/dist/server/next-server.js";R();var wr=$("module"),Qs=wr._resolveFilename;var br=$.resolve("./cache.cjs"),Re=new vr.default({conf:{...T,compress:!1,cacheHandler:br,cacheMaxMemorySize:0,experimental:{...T.experimental,trustHostHeader:!0}},customServer:!1,dev:!1,dir:__dirname}).getRequestHandler();globalThis.__als=new Er;async function xt(e,t){e.headers["x-forwarded-host"]&&(e.headers.host=e.headers["x-forwarded-host"]),x("internalEvent",e);let r={internalEvent:e,isExternalRewrite:!1,origin:!1,isISR:!1};try{r=await Se(e)}catch(o){ve("Routing failed.",o)}let s="type"in r?r.headers:r.internalEvent.headers,a=Object.entries("type"in r?r.headers:r.internalEvent.headers).reduce((o,[n,i])=>{if(n.startsWith("x-middleware-response-")){let c=n.replace("x-middleware-response-","");return delete s[n],s[c]=i,{...o,[c]:i}}else return o},{});if("type"in r){let o=_e(e,s,t);return o.statusCode=r.statusCode,o.flushHeaders(),o.write(r.body),o.end(),r}else{let o=r.internalEvent;x("preprocessedEvent",o);let n={method:o.method,url:o.url,headers:{...s,purpose:"prefetch"},body:o.body,remoteAddress:o.remoteAddress},i=Math.random().toString(36),c=new ce;return await globalThis.__als.run({requestId:i,pendingPromiseRunner:c},async()=>{let u=r,d=new Q(n),f=_e(o,a,t);await _r(d,f,o,u.isExternalRewrite);let{statusCode:g,headers:h,isBase64Encoded:y,body:m}=et(f),w={type:e.type,statusCode:g,headers:h,body:m,isBase64Encoded:y};return delete globalThis.lastModified[i],await c.await(),w})}}async function _r(e,t,r,s){delete e.body;try{let{rawPath:a}=r;if(s)return at(r,t);await Re(e,t)}catch(a){a.constructor.name==="NoFallbackError"?await yt("404",t,r):(A("NextJS request failed.",a),await yt("500",t,r))}}async function yt(e,t,r){try{let s=new Q({method:"GET",url:`/${e}`,headers:r.headers,body:r.body,remoteAddress:r.remoteAddress});await Re(s,t)}catch(s){A("NextJS request failed.",s),t.setHeader("Content-Type","application/json"),t.end(JSON.stringify({message:"Server failed to respond.",details:s},null,2))}}async function Ft(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(Et(),bt))).default}async function qt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(Ct(),_t))).default}async function Bt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(Mt(),Pt))).default}async function $t(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(It(),Ot))).default}async function Lt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(kt(),Dt))).default}async function Ut(){let e=await import(process.cwd()+"/open-next.config.mjs").then(a=>a.default),t=globalThis.fnName?e.functions[globalThis.fnName]:e.default;globalThis.serverId=Qe(),globalThis.queue=await $t(t.override?.queue),globalThis.incrementalCache=await Lt(t.override?.incrementalCache),globalThis.tagCache=await Bt(t.override?.tagCache),globalThis.lastModified={};let r=await Ft(t.override?.converter),s=await qt(t.override?.wrapper);return x("Using wrapper",s.name),s.wrapper(xt,r)}X();Xe();ts();es();globalThis.internalFetch=fetch;var Ga=await Ut();function es(){process.chdir(__dirname)}function ts(){process.env.NEXT_BUILD_ID=L}export{Ga as handler};
/*! Bundled license information:

aws4fetch/dist/aws4fetch.esm.mjs:
  (**
   * @license MIT <https://opensource.org/licenses/MIT>
   * @copyright Michael Hart 2024
   *)
*/
